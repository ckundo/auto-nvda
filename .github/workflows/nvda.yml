name: Build
on: [push]
jobs:
  nvda:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - name: Setup FFmpeg
        uses: FedericoCarboni/setup-ffmpeg@v2
      - name: Guidepup Setup
        uses: guidepup/setup-action@0.11.2
        with:
          record: true
      - run: yarn install
      - name: Install browsers
        run: |
          npx playwright install --with-deps chromium
      - name: Install video device
        shell: bash
        run: |
          curl "https://github.com/rdp/screen-capture-recorder-to-video-windows-free/releases/download/v0.13.3/Setup.Screen.Capturer.Recorder.v0.13.3.exe" -o recorder.exe
          open recorder.exe
      - run: ffmpeg -list_devices true -f dshow -i dummy
      - name: Run tests
        run: |
          npx playwright test
      - uses: actions/upload-artifact@v3
        if: always()
        continue-on-error: true
        with:
          name: artifacts
          path: |
            **/test-results/**/*
            **/recordings/**/*
